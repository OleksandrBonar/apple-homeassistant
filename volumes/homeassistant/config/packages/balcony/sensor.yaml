balcony_sensor:
  sensor:
    - platform: template
      sensors:
        balcony_sensor_dew_point:
          friendly_name: "Balcony Sensor Dew Point: "
          device_class: temperature
          unit_of_measurement: C
          value_template: >-
            {% set temp = states('sensor.snzb_02_05_01_temperature') | float(0) %}
            {% set humidity = states('sensor.snzb_02_05_01_humidity') | float(0) %}
            {% if temp >= 0.0 %}
              {% set a = 7.5 %}
              {% set b = 237.3 %}
            {% else %}
              {% set a = 7.6 %}
              {% set b = 240.7 %}
            {% endif %}
            {% set sdd = (6.1078 * (10.0 ** ((a * temp) / (b + temp)))) %}
            {% set dd = (humidity / 100 * sdd) %}
            {% set v = (dd / 6.107) | log(10) %}
            {% set td = ((b * v) / (a - v)) %}
            {{ td | round(2) }}

        balcony_sensor_dew_point2:
          friendly_name: "Balcony Sensor Dew Point: "
          device_class: temperature
          unit_of_measurement: C
          value_template: >-
            {% set a0 = 373.15 / (273.15 + states('sensor.snzb_02_05_01_temperature') | float(0)) %}
            {% set sum = -7.90298 * (a0 - 1) %}
            {% set sum = sum + 5.02808 * log(a0, 10) %}
            {% set sum = sum + -1.3816e-7 * (10 ** (11.344 * (1 - 1 / a0)) - 1) %}
            {% set sum = sum + 8.1328e-3 * (10 ** (-3.49149 * (a0 - 1)) - 1) %}
            {% set sum = sum + log(1013.246, 10) %}
            {% set vp = (10 ** (sum - 3)) * states('sensor.snzb_02_05_01_humidity') | float(0) %}
            {% set td = log(vp / 0.61078) %}
            {% set td = (241.88 * td) / (17.558 - td) %}
            {{ td | round(2) }}

        balcony_sensor_apparent_temperature:
          friendly_name: "Balcony Sensor Apparent Temperature: "
          device_class: temperature
          unit_of_measurement: C
          value_template: >-
            {% set temp = states('sensor.snzb_02_05_01_temperature') | float(0) %}
            {% set humidity = states('sensor.snzb_02_05_01_humidity') | float(0) %}
            {% set t = temp * 9/5 + 32 %}
            {% set rh = humidity %}
            {% set hi = 0 %}
            {% if t <= 40.0 %}
              {% set hi = t %}
            {% else %}
              {% set hi = (-42.379 + 2.04901523*t + 10.14333127*rh - 0.22475541*t*rh - 0.00683783*t*t - 0.05481717*rh*rh + 0.00122874*t*t*rh + 0.00085282*t*rh*rh - 0.00000199*t*t*rh*rh) %}
              {% if rh < 13 and t >= 80 and t <= 112 %}
                {% set adjust = ((13-rh)/4)  * ((17-((t-95)|abs)/17)|sqrt) %}
                {% set hi = hi - adjust %}
              {% elif rh > 85 and t >= 80 and t <= 87 %}
                {% set adjust = ((rh-85)/10) * ((87-t)/5) %}
                {% set hi = hi + adjust %}
              {% elif t < 80 %}
                {% set hi = 0.5 * (t + 61.0 + ((t-68.0)*1.2) + (rh*0.094)) %}
              {% endif %}
            {% endif %}
            {% set apparent_temp = (hi - 32) * 5/9 %}
            {{ apparent_temp | round(2) }}
