entrance_automation:
  automation:

    - alias: Entrance - Automation - Light Auto ON for motion when dark
      initial_state: true
      trigger:
        - platform: state
          entity_id: binary_sensor.entrance_motion
          to: "on"
      condition:
        - condition: or
          conditions:
            - condition: sun
              after: sunset
            - condition: sun
              before: sunrise
        - condition: state
          entity_id: person.oleksandr
          state: "home"
        - condition: or
          conditions:
            - condition: state
              entity_id: light.entrance
              state: "off"
            - condition: numeric_state
              entity_id: light.entrance
              attribute: brightness
              below: 255
      action:
        - service: light.turn_on
          target:
            entity_id: light.entrance
          data:
            brightness_pct: 100
        - wait_for_trigger:
          - platform: state
            entity_id: binary_sensor.entrance_motion
            to: "off"
        - service: light.turn_on
          target:
            entity_id: light.entrance
          data:
            brightness_pct: 15

    - alias: Entrance - Automation - Long motion
      initial_state: true
      trigger:
        - platform: state
          entity_id: binary_sensor.entrance_motion
          to: "on"
          for:
             minutes: 5
      condition:
        - condition: state
          entity_id: person.oleksandr
          state: "not_home"
      action:
        - service: light.turn_on
          target:
            entity_id: light.entrance
          data:
            brightness_pct: 100
        - service: notify.telegram_user_oleksandr
          data:
            message: "Security: Someone is at the door for a long time"
