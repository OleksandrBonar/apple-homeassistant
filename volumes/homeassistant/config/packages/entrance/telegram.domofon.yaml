entrance_telegram_domofon:
  automation:
    - id: domofon_open_when_dark_notification
      alias: Domofon - Open When Dark Notification
      initial_state: true
      trigger:
        - platform: state
          entity_id: sensor.domofon_state
          to: "Open"
      condition:
        - condition: or
          conditions:
            - condition: sun
              after: sunset
              after_offset: "+00:30:00"
            - condition: sun
              before: sunrise
              before_offset: "-00:30:00"
        - condition: or
          conditions:
            - condition: state
              entity_id: light.entrance
              state: "off"
            - condition: numeric_state
              entity_id: light.entrance
              value_template: '{{ state.attributes.brightness_pct }}'
              below: 50
      action:
        - service: light.turn_on
          target:
            entity_id: light.entrance
          data:
            brightness_pct: 50
        - wait_for_trigger:
          - platform: state
            entity_id: light.entrance
            to: "off"
          timeout: "00:02:00"
        - service: light.turn_off
          target:
            entity_id: light.entrance
